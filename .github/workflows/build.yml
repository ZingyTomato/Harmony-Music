on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  build:
    runs-on: ['ubuntu-24.04']
    steps:
    - uses: actions/checkout@v2

    - uses: actions/setup-python@v2
      with:
        python-version: "3.10"

    - run: pip install -r requirements.txt pyinstaller

    - run: pyinstaller --onefile ./harmony/harmony.py

    - name: Upload to Release
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ github.event.release.upload_url }}
        asset_path: ./dist/harmony
        asset_name: harmony
        asset_content_type: application/octet-stream